# 보안 기능 설정

운영 환경에서 클러스터에 보안 기능을 활성화하는 정책은 선택이 아닌 필수다.  
보안 기능이 적용되지 않은채로 외부망에 공개된 많은 운영 클러스터들이 정보 유출, 데이터 유싱등의 위험이 있다.  
 
* 사용자 역할 기반의 접근 제어 
* 노드간 통신 암호화 
* HTTP 통신 암호화 
 
유료 서브크립션을 사용한다면,   
IDAP 및 SAML 등과 같이 외부 인증 체계와 연동할 수 있는 방법을 제공하며    
사용자별로 조회할 수 있는 문서나 필드를 제한할 수 있다.       
(ID 및 PASSWORD 접근하고 각 사용자별 역할에 따라 기능 제한 -> 특정 인덱스에 대한 읽기, 쓰기 제한)   
이런 설정이 없다면 외부에 공개된 채로 아무나 API를 통해 인덱스 조작이 가능하다.     
   
과거에는 엘라스틱서치의 보안 기능을 사용허려면    
기본적인 로그인이나 역할 기반 접근 제어 기능을 포함하는 유료 서브스크립션을 요구했기에       
별도로 보안이 적용된 프록시를 구축하거나 네트워크 정책등을 이용해 접근을 제어해야했다.   

하지만, 6.8 이후부투너는 무료로 제공되는 베이직 라이선스에서도 보안 기능을 사용할 수 있게 되었으므로 반드시 활성화하자.   

**config/elasticsearch.yml**
```
xpack.security.enabled: true
```
위와 같이 설정을 하면 엘라스틱 서치의 보안 기능을 활성화할 수 있다.   
하지만, 설정만으로 보안을 완벽히 구성할 수는 없다.   
  
보안 설정시 전송 계층 보안을 적용하는 과정에서 반드시 전체 클러스터 재시작이 필요하다.     
실제 운영중인 클러스터라면 서비스가 일시적으로 멈추게 되므로 귀찮더라도 되도록 보안 설정은 초기 구축시 진행하자.  

## 인증서 생성 
 
암호화 과정에서, 가장 먼저 해야할 것은 인증서이다(키를 준 벤더가 맞는지 확인하는 인증서)      
참고로 인증서는 각각의 CA에서 공개키로 암호화되어있기에. 이를 CA 측에서 복호화가 가능하면 인증된 사용처임을 나타낸다.   

엘라스틱서치는 자체적으로 elasticsearch-certutil 이라는 인증서 생성용 도구를 제공한다.   
엘라스틱서치에서 제공하는 인증서 생성 도구를 이용해 인증서를 생성하면 아래와 같다.   

